<Page x:Class="Pro.Client.Views.History"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="clr-namespace:Pro.Client.Views"
      xmlns:views="clr-namespace:Pro.Client.Views"
      Title="Purchase History" Background="#F8FAFC">

    <Page.Resources>
        <views:BoolToVisibilityInverseConverter x:Key="BoolToVisibilityInverseConverter"/>
    </Page.Resources>

    <Grid Background="#F8FAFC">
        <ScrollViewer VerticalScrollBarVisibility="Auto">
            <Grid Margin="24" MaxWidth="1100" HorizontalAlignment="Center">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,0,16">
                    <TextBlock Text="Purchase History" FontSize="24" FontWeight="Bold" />
                    <Border Background="#E7EDF4" BorderBrush="#CEDBE9" BorderThickness="1" CornerRadius="6"
                            Padding="8,4" Margin="12,2,0,0">
                        <TextBlock x:Name="SummaryText" Text="—" Foreground="#0D141C"/>
                    </Border>
                </StackPanel>

                <Border Grid.Row="1" Background="White" BorderBrush="#E7EDF4" BorderThickness="1" CornerRadius="12" Padding="16" Margin="0,0,0,16">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2*"/>
                            <ColumnDefinition Width="2*"/>
                            <ColumnDefinition Width="2*"/>
                            <ColumnDefinition Width="2*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0" Margin="0,0,12,0">
                            <TextBlock Text="From" Margin="0,0,0,4"/>
                            <DatePicker x:Name="FromPicker"/>
                        </StackPanel>

                        <StackPanel Grid.Column="1" Margin="0,0,12,0">
                            <TextBlock Text="To" Margin="0,0,0,4"/>
                            <DatePicker x:Name="ToPicker"/>
                        </StackPanel>

                        <StackPanel Grid.Column="2" Margin="0,0,12,0">
                            <TextBlock Text="Status" Margin="0,0,0,4"/>
                            <ComboBox x:Name="StatusBox" SelectedIndex="0">
                                <ComboBoxItem Content="All"/>
                                <ComboBoxItem Content="Pending"/>
                                <ComboBoxItem Content="Completed"/>
                                <ComboBoxItem Content="Failed"/>
                                <ComboBoxItem Content="Refunded"/>
                            </ComboBox>
                        </StackPanel>

                        <StackPanel Grid.Column="3" Margin="0,0,12,0">
                            <TextBlock Text="Search (method or order id)" Margin="0,0,0,4"/>
                            <TextBox x:Name="SearchBox" Height="30" KeyDown="SearchBox_KeyDown"/>
                        </StackPanel>

                        
                        <StackPanel Grid.Column="4" Orientation="Horizontal" VerticalAlignment="Bottom">
                            <Button Content="Apply" Click="ApplyFilters_Click"
                                    Background="#0B80F4" Foreground="White" Padding="16,6" Margin="0,0,8,0"/>
                            <Button Content="Reset" Click="ResetFilters_Click"
                                    Background="#E7EDF4" Foreground="#0D141C" Padding="16,6"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <Border Grid.Row="2" Background="White" BorderBrush="#E7EDF4" BorderThickness="1" CornerRadius="12" Padding="0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <DataGrid x:Name="GridPayments"
                                  Grid.Row="0"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  AutoGenerateColumns="False"
                                  IsReadOnly="True"
                                  HeadersVisibility="Column"
                                  GridLinesVisibility="None"
                                  RowHeaderWidth="0"
                                  AlternationCount="2"
                                  Margin="0">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Date" Binding="{Binding Date, StringFormat={}{0:yyyy-MM-dd HH:mm}}" Width="170"/>
                                <DataGridTextColumn Header="Amount" Binding="{Binding AmountDisplay}" Width="120"/>
                                <DataGridTextColumn Header="Payment" Binding="{Binding Status}" Width="120"/>
                                <DataGridTextColumn Header="Return" Binding="{Binding ReturnStatus}" Width="110"/>
                                <DataGridTextColumn Header="Method" Binding="{Binding Method}" Width="160"/>
                                <DataGridTextColumn Header="Order ID" Binding="{Binding OrderId}" Width="*"/>
                                <DataGridTemplateColumn Header="" Width="120">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Button Content="Details" Click="Details_Click" Padding="10,4"
                                                    Background="#E7EDF4" Foreground="#0D141C" BorderBrush="#CEDBE9"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTemplateColumn Header="" Width="120">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Button Content="Return"
                                                    Click="Return_Click"
                                                    IsEnabled="{Binding IsReturnAllowed}"
                                                    Padding="10,4"
                                                    Background="#FFE8CC"
                                                    Foreground="#0D141C"
                                                    BorderBrush="#F2C48C"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>

                        <Border Grid.Row="0" Background="Transparent"
                                Visibility="{Binding ElementName=GridPayments, Path=HasItems, Converter={StaticResource BoolToVisibilityInverseConverter}}">
                            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Margin="16">
                                <TextBlock Text="No purchases found." FontSize="16" FontWeight="SemiBold" HorizontalAlignment="Center" />
                                <TextBlock Text="Try adjusting the date range, status, or search term."
                                           Foreground="#718096" HorizontalAlignment="Center" Margin="0,8,0,0"/>
                            </StackPanel>
                        </Border>

                        <DockPanel Grid.Row="1" Margin="12">
                            <TextBlock x:Name="FooterText" DockPanel.Dock="Right" TextAlignment="Right" />
                        </DockPanel>
                    </Grid>
                </Border>
            </Grid>
        </ScrollViewer>
    </Grid>
</Page>
